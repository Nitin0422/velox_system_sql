{% extends "base.html" %} {% block content %} {% load static %}
<div>
  <div class="card mb-4">
    <div class="card-header d-flex align-items-center justify-content-between">
      <h5 class="mb-0">Invoices <Form></Form></h5>
      <small class="text-muted float-end"></small>
    </div>
    <div class="card-body">
      <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-text text-danger">{{ form.errors }}</div>
        {% if is_admin %}
        <div class= "row mb-3">
          <label
            class="col-sm-2 col-form-label"
            for="{{form.employee.id_for_label}}"
            >{{form.employee.label}}</label
          >
          <div class="col-sm-10">
            {{form.employee}}
          </div>    
          {% for error in form.employee.errors %}
          <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}    
        </div> 
        {% endif %}

        <div class= "row mb-3" style="display: none;">
          <label
            class="col-sm-2 col-form-label"
            for="{{form.employee.id_for_label}}"
            >{{form.employee.label}}</label
          >
          <div class="col-sm-10">
            {{form.employee}}
          </div>    
          {% for error in form.employee.errors %}
          <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}    
        </div> 
         
        <div class="row mb-3">
          <label
            class="col-sm-2 col-form-label"
            for="{{form.customer.id_for_label}}"
            >{{form.customer.label}}</label
          >
          <div class="col-sm-10">
            {{form.customer}}
            {% for error in form.customer.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}  
          </div>  
                 
        </div>

        <div class="row mb-3">
          <label
            class="col-sm-2 col-form-label"
            for="{{form.task_category.id_for_label}}"
            >{{form.task_category.label}}</label
          >
          <div class="col-sm-10">
            {{form.task_category}}
            {% for error in form.task_category.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}  
          </div> 
                  
        </div>

        <div class="row mb-3">
          <label
            class="col-sm-2 col-form-label"
            for="{{form.task_code.id_for_label}}"
            >{{form.task_code.label}}</label
          >
          <div class="col-sm-10">
            {{form.task_code}}
            {% for error in form.task_code.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}   
          </div>   
            
        </div>

        <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="{{form.deal_amount.id_for_label}}"
            >Deal Amount</label
          >
          <div class="col-sm-10">
            <input
              type="text"
              class="form-control"
              id="{{form.deal_amount.id_for_label}}"
              name="{{form.deal_amount.name}}"
              value="{{form.deal_amount.value}}"
            />
            {% for error in form.deal_amount.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}
          </div>
          
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="{{form.paid_amount.id_for_label}}"
            >Paid Amount</label
          >
          <div class="col-sm-10">
            <input
              type="text"
              id="{{form.paid_amount.id_for_label}}"
              class="form-control phone-mask"
              name="{{form.paid_amount.name}}"
              value="{{form.paid_amount.value}}"
            />
            {% for error in form.paid_amount.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}
          </div>
        </div>
        <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="{{form.due_amount.id_for_label}}"
            >Due Amount</label
          >
          <div class="col-sm-10">
            <input
              type="text"
              id="{{form.due_amount.id_for_label}}"
              class="form-control phone-mask"
              name="{{form.due_amount.name}}"
              value="{{form.due_amount.value}}"
              readonly
            />
            {% for error in form.due_amount.errors %}
            <div class="d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
          {% endfor %}
          </div>
        </div>

        <div class="row mb-3">
            <label class="col-sm-2 col-form-label" for="{{form.invoice_date.id_for_label}}"
              >Invoice Date</label
            >
            <div class="col-sm-10">
              <input
                type="date"
                id="{{form.invoice_date.id_for_label}}"
                class="form-control phone-mask"
                name="{{form.invoice_date.name}}"
                value="{{form.invoice_date.value}}"
              />
              {% for error in form.invoice_date.errors %}
            <div class="d-flex px-2 text-danger">{{ error }}</div>
          {% endfor %}
            </div>
          </div>

        <div class="row mb-3">
          <label class="col-sm-2 col-form-label" for="{{form.bill_file.id_for_label}}"
            >Bill File</label
          >
          <div class="col-sm-10">
            <input class="form-control" type="file" id="{{form.bill_file.id_for_label}}" name="{{form.bill_file.name}}" value="{{form.bill_file.value}}"/>
          </div>
          {% for error in form.bill_file.errors %}
          <div class=" d-flex w-50 justify-content-center px-2 text-danger">{{ error }}</div>
        {% endfor %}
        </div>
       
        <div class="row justify-content-end mt-4">
          <div class="col-sm-10">
            <button type="submit" class="btn btn-primary">Add</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Get references to the input fields
  const dealAmountInput = document.getElementById('id_deal_amount');
  const paidAmountInput = document.getElementById('id_paid_amount');
  const dueAmountInput = document.getElementById('id_due_amount');

  // Add an input event listener to both dealAmountInput and paidAmountInput
  dealAmountInput.addEventListener('input', updateDueAmount);
  paidAmountInput.addEventListener('input', updateDueAmount);

  // Function to update the Due Amount
  function updateDueAmount() {
    const dealAmount = parseFloat(dealAmountInput.value) || 0;
    const paidAmount = parseFloat(paidAmountInput.value) || 0;

    const dueAmount = dealAmount - paidAmount;

    // Update the Due Amount input field
    dueAmountInput.value = dueAmount.toFixed(2);
  }
</script>


<script src="{% static 'assets/js/form-basic-inputs.js' %}"></script>


{% endblock %}
